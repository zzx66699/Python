# Chapter6 数据分组、透视
## 分组 .groupby()
df.groupby('按照xx分组的列')['要进行操作的列'].操作方式()  

EXAMPLE:  
``` python
n = nowcoder.groupby('date')['question_id'].count()    # 一定要加数xxx
```

根据两个条件分组  

``` python
nowcoder['year-month-day']= pd.to_datetime(nowcoder['date']).dt.date
df = nowcoder.groupby(['result','year-month-day'])['year-month-day'].count()
print(df)
```
<img width="397" alt="image" src="https://user-images.githubusercontent.com/105503216/183256387-856b23cd-87e0-4d9a-a15b-2ce6ca28557e.png">

``` python
 print(df.index)     # df是series 并且是不显示根据某一列数的那一列！！！！
 ```
 <img width="560" alt="image" src="https://user-images.githubusercontent.com/105503216/183276324-e4508f63-1b4c-4c67-8987-eed70bad384d.png">  
 
 ### 当我们需要显示根据那列的列名的时候 注意用[[]] 
 ``` python
 ct = df.groupby(['sex','department','item_name'])[['employee_id']].count()
 print(ct)
```
<img width="291" alt="image" src="https://user-images.githubusercontent.com/105503216/183337726-dac7eb16-a522-415b-b85a-e54bd72425a9.png">  

此时ct是一个dataframe   
<img width="970" alt="image" src="https://user-images.githubusercontent.com/105503216/183337794-115169d3-a17b-4777-bce2-25175b079ba4.png">  

## unstack() 把inner layer变成column
``` python
ct = df.groupby(['sex','department','item_name'])[['employee_id']].count().unstack()
print(ct)
```
<img width="305" alt="image" src="https://user-images.githubusercontent.com/105503216/183338199-f76bd7f5-3a74-44d7-acd0-9113e0eca988.png">  


## 数据透视表 Pivot table 
Explore the percentage of survival by sex and classes.
``` python
d = data_titan.pivot_table('survived', columns='class', index='sex')
d           # 这里可以参考agg里面的多个column分组 简化写法
class	First	        Second	        Third
sex			
female	0.968085	0.921053	0.500000
male	0.368852	0.157407	0.135447

d.index.name = None   # 把index和column的名字删去
d.columns.name = None
d
        First	        Second	        Third
female	0.968085	0.921053	0.500000
male	0.368852	0.157407	0.135447
```
index也可以是multi layer
``` python
d = data_titan.pivot_table('survived', index=[age, 'sex'], columns='class') 
# 注意这里的age都不是dataframe中的一列 是独立的variable 默认一一对应起来了
```
![image](https://user-images.githubusercontent.com/105503216/171981570-d42874ad-a548-4439-a5f0-113061ea748a.png)
